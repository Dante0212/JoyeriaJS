<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- template del reporte -->
  <template id="report_stock_transfer_document">
    <!-- usamos el layout estándar de Odoo -->
    <t t-call="web.external_layout">
      <main class="page">
        <h2 style="text-align:center;">Cargos entre Locales</h2>
        <p><strong>Fecha de generación:</strong> <t t-esc="time.strftime('%Y-%m-%d %H:%M:%S')"/></p>
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Origen</th>
              <th>Destino</th>
              <th>Producto</th>
              <th>Cantidad</th>
              <th>Precio Unitario</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <!-- recorremos cada registro que llega desde el modelo -->
            <t t-foreach="docs" t-as="doc">
              <t t-foreach="doc.move_lines" t-as="line">
                <tr>
                  <td><t t-esc="doc.location_src_id.name"/></td>
                  <td><t t-esc="doc.location_dest_id.name"/></td>
                  <td><t t-esc="line.product_id.display_name"/></td>
                  <td class="text-right"><t t-esc="line.product_uom_qty"/></td>
                  <td class="text-right"><t t-esc="'{:,.2f}'.format(line.price_unit)"/></td>
                  <td class="text-right"><t t-esc="'{:,.2f}'.format(line.product_uom_qty * line.price_unit)"/></td>
                </tr>
              </t>
            </t>
          </tbody>
        </table>
        <p style="text-align:right; font-weight:bold;">
          Total general: 
          <t t-esc="'{:,.2f}'.format(sum(line.product_uom_qty * line.price_unit for doc in docs for line in doc.move_lines))"/>
        </p>
      </main>
    </t>
  </template>
</odoo>
