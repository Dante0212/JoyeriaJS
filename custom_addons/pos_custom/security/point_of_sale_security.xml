<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Categoría de Módulo -->
    <record id="base.module_category_sales_point_of_sale" model="ir.module.category">
        <field name="description">
            Helps you get the most out of your points of sale with fast sale encoding, simplified payment mode encoding, automatic picking lists generation and more.
        </field>
        <field name="sequence">21</field>
    </record>

    <!-- Grupos -->
    <record id="group_pos_user"        model="res.groups">
        <field name="name">User</field>
        <field name="category_id" ref="base.module_category_sales_point_of_sale"/>
    </record>
    <record id="group_pos_manager"     model="res.groups">
        <field name="name">Administrator</field>
        <field name="category_id" ref="base.module_category_sales_point_of_sale"/>
        <field name="implied_ids" eval="[
            (4, ref('group_pos_user')),
            (4, ref('stock.group_stock_user'))
        ]"/>
        <field name="users" eval="[
            (4, ref('base.user_root')),
            (4, ref('base.user_admin'))
        ]"/>
    </record>

    <data noupdate="1">
        <!-- 1) Permite al contador ver todos los extractos bancarios -->
        <record id="rule_pos_bank_statement_account_user" model="ir.rule">
            <field name="name">Point Of Sale Bank Statement Accountant</field>
            <field name="model_id" ref="account.model_account_bank_statement"/>
            <field name="groups" eval="[(4, ref('account.group_account_invoice'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
        </record>

        <!-- 2) Usuario POS ve sólo líneas con sesión POS -->
        <record id="rule_pos_bank_statement_line_user" model="ir.rule">
            <field name="name">Point Of Sale Bank Statement Line POS User</field>
            <field name="model_id" ref="account.model_account_bank_statement_line"/>
            <field name="groups" eval="[(4, ref('pos_custom.group_pos_user'))]"/>
            <!-- Aquí estaba el error: pos_session_id no existe en account.bank.statement.line -->
            <field name="domain_force">[('statement_id.pos_session_id', '!=', False)]</field>
        </record>

        <!-- 3) Contador POS ve todas las líneas -->
        <record id="rule_pos_bank_statement_line_account_user" model="ir.rule">
            <field name="name">Point Of Sale Bank Statement Line Accountant</field>
            <field name="model_id" ref="account.model_account_bank_statement_line"/>
            <field name="groups" eval="[(4, ref('account.group_account_invoice'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
        </record>

        <!-- Reglas multi-empresa para órdenes y sesiones POS -->
        <record id="rule_pos_multi_company" model="ir.rule">
            <field name="name">Point Of Sale Order</field>
            <field name="model_id" ref="model_pos_order"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        </record>
        <record id="rule_pos_order_line_multi_company" model="ir.rule">
            <field name="name">Point Of Sale Order Line</field>
            <field name="model_id" ref="model_pos_order_line"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        </record>
        <record id="rule_pos_session_multi_company" model="ir.rule">
            <field name="name">Point Of Sale Session</field>
            <field name="model_id" ref="model_pos_session"/>
            <field name="domain_force">[('config_id.company_id', 'in', company_ids)]</field>
        </record>
        <record id="rule_pos_config_multi_company" model="ir.rule">
            <field name="name">Point Of Sale Config</field>
            <field name="model_id" ref="model_pos_config"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        </record>

        <!-- Permiso para ver facturas POS -->
        <record id="rule_invoice_pos_user" model="ir.rule">
            <field name="name">Invoice POS User</field>
            <field name="model_id" ref="account.model_account_move"/>
            <field name="groups" eval="[(4, ref('pos_custom.group_pos_user'))]"/>
            <field name="domain_force">[('pos_order_ids', '!=', False)]</field>
        </record>

        <!-- Por defecto asignamos al administrador POS -->
        <record id="base.default_user" model="res.users">
            <field name="groups_id" eval="[(4, ref('pos_custom.group_pos_manager'))]"/>
        </record>
    </data>
</odoo>
