<odoo>
  <report id="action_report_daily_rma" model="pos.session"
          string="Diario RMA + POS" report_type="qweb-pdf"
          name="pos_daily_rma_report_no_wizard.template_pos_daily_rma"
          file="pos_daily_rma_report_no_wizard.template_pos_daily_rma"
          attachment_use="False"/>
  <template id="template_pos_daily_rma">
    <t t-call="web.external_layout">
      <div class="page">
        <h1>Diario RMA + POS</h1>
        <p>Fecha: <t t-esc="data.get('date_start') or request.env['ir.fields'].Date.context_today(request.env.user)"/></p>
        <h2>Reparaciones (RMA) Hoy</h2>
        <t t-set="today" t-value="data.get('date_start') or request.env['ir.fields'].Date.context_today(request.env.user)"/>
        <t t-set="rmas" t-value="env['joyeria.reparacion'].search([
            ('fecha_retiro','>=', today),
            ('fecha_retiro','<=', today)
        ])"/>
        <table class="table table-condensed">
          <tr><th>Ref</th><th>Tienda</th><th>Total</th></tr>
          <t t-foreach="rmas" t-as="r">
            <tr>
              <td><t t-esc="r.name"/></td>
              <td><t t-esc="r.local_tienda"/></td>
              <td><t t-esc="r.amount_total"/></td>
            </tr>
          </t>
          <tr class="font-weight-bold">
            <td colspan="2">Total RMA</td>
            <td><t t-esc="sum(r.amount_total for r in rmas)"/></td>
          </tr>
        </table>
        <h2>Ventas POS Hoy</h2>
        <t t-set="poses" t-value="env['pos.order'].search([
            ('date_order','>=', today + ' 00:00:00'),
            ('date_order','<=', today + ' 23:59:59')
        ])"/>
        <table class="table table-condensed">
          <tr><th>Ref</th><th>Sessi√≥n</th><th>Total</th></tr>
          <t t-foreach="poses" t-as="p">
            <tr>
              <td><t t-esc="p.name"/></td>
              <td><t t-esc="p.session_id.name"/></td>
              <td><t t-esc="p.amount_total"/></td>
            </tr>
          </t>
          <tr class="font-weight-bold">
            <td colspan="2">Total POS</td>
            <td><t t-esc="sum(p.amount_total for p in poses)"/></td>
          </tr>
        </table>
        <h2>Gran Total</h2>
        <p><strong><t t-esc="sum(r.amount_total for r in rmas) + sum(p.amount_total for p in poses)"/></strong></p>
      </div>
    </t>
  </template>
</odoo>
