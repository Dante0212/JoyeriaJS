<!-- stock_transfer_charge_report_templates.xml -->
<odoo>
  <data>
    <template id="stock_transfer_charge">
      <t t-call="web.html_container">
        <t t-foreach="docs" t-as="o">
          <t t-call="web.external_layout">
            <div class="page" style="position:relative; padding-top:2cm;">

              <!-- Firma superior -->
              <div style="position:absolute; top:0; right:0; text-align:right;">
                <p><strong>Entregó:</strong> ____________________</p>
                <p><strong>Recibió:</strong> ____________________</p>
              </div>

              <!-- Contexto de precios -->
              <t t-set="pr" t-value="pricelist"/>
              
              <table class="table table-sm" border="1" cellpadding="4" cellspacing="0">
                <thead>
                  <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>UoM</th>
                    <th>Peso (g)</th>
                    <th>Precio Interno</th>
                    <th>Costo Interno</th>
                  </tr>
                </thead>
                <tbody>
                  <tr t-foreach="o.move_line_ids_without_package" t-as="ml">
                    <td><t t-esc="ml.product_id.display_name"/></td>
                    <td><t t-esc="ml.quantity or 0.0"/></td>
                    <td><t t-esc="ml.product_uom_id.name"/></td>
                    <td><t t-esc="ml.product_id.weight or 0.0"/></td>
                    <!-- Obtenemos el precio interno unitario desde el pricelist -->
                    <td>
                      <t t-esc="pr and pr.get_product_price(ml.product_id, ml.quantity or 0.0, False) or 0.0"/>
                    </td>
                    <!-- Coste = cantidad * precio interno -->
                    <td>
                      <t t-esc="(ml.quantity or 0.0) * (pr and pr.get_product_price(ml.product_id, ml.quantity or 0.0, False) or 0.0)"/>
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <th colspan="4" style="text-align:right;">Totales:</th>
                    <th></th>
                    <th>
                      <t t-esc="sum([
                        (ml.quantity or 0.0) * (pr and pr.get_product_price(ml.product_id, ml.quantity or 0.0, False) or 0.0)
                        for ml in o.move_line_ids_without_package
                      ])"/>
                    </th>
                  </tr>
                </tfoot>
              </table>

            </div>
          </t>
        </t>
      </t>
    </template>
  </data>
</odoo>
